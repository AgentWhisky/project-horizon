"use strict";var U=Object.create;var g=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty;var O=(o,e)=>{for(var n in e)g(o,n,{get:e[n],enumerable:!0})},A=(o,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of S(e))!P.call(o,t)&&t!==n&&g(o,t,{get:()=>e[t],enumerable:!(i=x(e,t))||i.enumerable});return o};var H=(o,e,n)=>(n=o!=null?U(T(o)):{},A(e||!o||!o.__esModule?g(n,"default",{value:o,enumerable:!0}):n,o));var s=require("discord.js");var y=H(require("dotenv"));y.default.config();var{DISCORD_BOT_TOKEN:N,DISCORD_CLIENT_ID:h}=process.env;if(!N||!h)throw new Error("Missing Bot Token or Client ID environment variables");var r={DISCORD_BOT_TOKEN:N,DISCORD_CLIENT_ID:h,HORIZON_API_URL:process.env.HORIZON_API_URL??"",HORIZON_APP_URL:process.env.HORIZON_APP_URL??"",HORIZON_ICON_URL:process.env.HORIZON_ICON_URL??"",DEVELOPER_ICON_URL:process.env.DEVELOPER_ICON_URL??""};var d=require("discord.js");var u={};O(u,{data:()=>b,execute:()=>v});var C=require("discord.js"),b=new C.SlashCommandBuilder().setName("ping").setDescription("Replies with Pong!");async function v(o){let e=Math.random();return o.reply(`Pong! ${e} - Hello ${o.user.globalName}!`)}var I={};O(I,{data:()=>B,execute:()=>Z});var c=require("discord.js");var _=`${r.HORIZON_API_URL}/link-library/links`;async function L(o,e){let n=new URLSearchParams;o&&n.append("category",o),e&&n.append("search",e);let i=n.toString()?`${_}?${n.toString()}`:_,t=await fetch(i);if(!t.ok)throw new Error(`Failed to fetch Horizon links: ${t.status}`);return await t.json()}var B=new c.SlashCommandBuilder().setName("links").setDescription("Get useful links from Horizon").addStringOption(o=>o.setName("category").setDescription("Filter by category").setRequired(!1)).addStringOption(o=>o.setName("search").setDescription("Search term").setRequired(!1));async function Z(o){try{await o.deferReply();let e=o.options.getString("category"),n=o.options.getString("search"),i=await L(e,n),t="";i.length===0?n&&!e?t=`No links found matching your search: "${n}"`:!n&&e?t=`No links found under the category: "${e}"`:!n&&!e?t="I couldn't find any links to show you":t=`No links found for "${n}" in category "${e}"`:i.length===1?t="Here's a link I found for you":t=`Here are ${i.length} links I found for you`;let p=new c.EmbedBuilder().setColor(5132216).setTitle(t).setAuthor({name:"HorizonBot",iconURL:r.HORIZON_ICON_URL,url:r.HORIZON_APP_URL}).setTimestamp().setFooter({text:"Made by AgentWhisky",iconURL:r.DEVELOPER_ICON_URL}),E=i.slice(0,10);for(let f of E){let w=`[Navigate](<${f.url}>)`;p.addFields({name:f.name,value:`${w}
${f.description})`,inline:!1})}let K=await o.editReply({embeds:[p]})}catch(e){console.error("Fetch error:",e),await o.editReply("There was an error fetching your links.")}}var l={ping:u,links:I};var M=Object.values(l).map(o=>o.data),G=new d.REST({version:"10"}).setToken(r.DISCORD_BOT_TOKEN);async function R({guildId:o}){try{console.log("Started refreshing application (/) commands."),await G.put(d.Routes.applicationGuildCommands(r.DISCORD_CLIENT_ID,o),{body:M}),console.log("Successfully reloaded application (/) commands.")}catch(e){console.error(e)}}var k=require("date-fns"),$={DEFAULT:"\x1B[0m",INFO:"\x1B[32m",WARN:"\x1B[33m",ERROR:"\x1B[31m"};function a(o){console.log(`${$.INFO}[INFO] - [${z()}] ${o}${$.DEFAULT}`)}function z(){return(0,k.format)(new Date,"yyyy-MM-dd hh:mm:ss")}async function D(o){if(!o.isChatInputCommand())return;a(`Command [${o.commandName}] fired by [${o.user.globalName}] from ${o.guild?.name}`);let e=l[o.commandName];e&&e.execute(o)}var m=new s.Client({intents:[s.GatewayIntentBits.Guilds,s.GatewayIntentBits.GuildMessages,s.GatewayIntentBits.DirectMessages]});m.once(s.Events.ClientReady,()=>{a("HorizonBot is online and ready."),a(`Logged in as ${m.user?.tag}`),a(`Using Horizon API: ${r.HORIZON_API_URL}
`),a(`Connected to ${m.guilds.cache.size} server(s):`),m.guilds.cache.forEach(async o=>{a(`- ${o.name} (ID: ${o.id})`),await R({guildId:o.id})}),console.log(`
`)});m.on(s.Events.GuildCreate,async o=>{await R({guildId:o.id})});m.on(s.Events.InteractionCreate,async o=>{await D(o)});m.login(r.DISCORD_BOT_TOKEN);
